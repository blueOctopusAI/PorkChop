{% extends "base.html" %}

{% block title %}Spending — {{ bill.bill_type | upper }} {{ bill.bill_number }}{% endblock %}

{% block content %}
<section class="spending-detail">
    <h1>Spending Detail</h1>
    <h2><a href="/bill/{{ bill.id }}">{{ bill.bill_type | upper }} {{ bill.bill_number }}</a> — {{ bill.title[:80] }}</h2>
    <p class="total">Total: <strong>${{ "{:,.0f}".format(total) }}</strong> across {{ spending|length }} items</p>

    <table class="sortable">
        <thead>
            <tr>
                <th>Amount</th>
                <th>Purpose</th>
                <th>Recipient</th>
                <th>Availability</th>
                {% if pork_map %}<th>Pork Score</th>{% endif %}
            </tr>
        </thead>
        <tbody>
            {% for item in spending %}
            <tr class="{% if pork_map.get(item.id, {}).get('score', 0) >= 60 %}high-pork{% elif pork_map.get(item.id, {}).get('score', 0) >= 30 %}med-pork{% endif %}">
                <td class="amount">${{ "{:,.0f}".format(item.amount_numeric) if item.amount_numeric else item.amount }}</td>
                <td>{{ item.purpose or 'unspecified' }}</td>
                <td>{{ item.recipient or '-' }}</td>
                <td>{{ item.availability or '-' }}</td>
                {% if pork_map %}
                <td class="pork-score">
                    {% set ps = pork_map.get(item.id) %}
                    {% if ps %}
                    <span class="score score-{{ 'high' if ps.score >= 60 else 'med' if ps.score >= 30 else 'low' }}">
                        {{ ps.score }}
                    </span>
                    {% else %}-{% endif %}
                </td>
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endblock %}
